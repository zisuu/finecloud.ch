<!DOCTYPE html><html lang="de-ch"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Vaultwarden Backup mit Rclone - Finecloud</title><meta name="description" content="Vaultwarden ist eine alternative Implementation der Bitwarden Server API entwickelt in Rust, kompatibel mit allen Bitwarden clients. Vaultwarden eignet sich daher perfekt für self-hosted deployments, oder überall dort wo der offizielle Bitwarden Service nicht ideal geeignet ist. Dazu gibt es einmal das Vaultwarden Docker Image&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://www.finecloud.ch/vaultwarden-backup.html"><link rel="alternate" type="application/atom+xml" href="https://www.finecloud.ch/feed.xml"><link rel="alternate" type="application/json" href="https://www.finecloud.ch/feed.json"><meta property="og:title" content="Vaultwarden Backup mit Rclone"><meta property="og:site_name" content="Finecloud"><meta property="og:description" content="Vaultwarden ist eine alternative Implementation der Bitwarden Server API entwickelt in Rust, kompatibel mit allen Bitwarden clients. Vaultwarden eignet sich daher perfekt für self-hosted deployments, oder überall dort wo der offizielle Bitwarden Service nicht ideal geeignet ist. Dazu gibt es einmal das Vaultwarden Docker Image&hellip;"><meta property="og:url" content="https://www.finecloud.ch/vaultwarden-backup.html"><meta property="og:type" content="article"><link rel="shortcut icon" href="https://www.finecloud.ch/media/website/finecloud.png" type="image/png"><link rel="stylesheet" href="https://www.finecloud.ch/assets/css/style.css?v=7c7ed2e3e90182a09465f36ea7129616"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.finecloud.ch/vaultwarden-backup.html"},"headline":"Vaultwarden Backup mit Rclone","datePublished":"2022-05-24T07:23","dateModified":"2022-05-24T09:21","description":"Vaultwarden ist eine alternative Implementation der Bitwarden Server API entwickelt in Rust, kompatibel mit allen Bitwarden clients. Vaultwarden eignet sich daher perfekt für self-hosted deployments, oder überall dort wo der offizielle Bitwarden Service nicht ideal geeignet ist. Dazu gibt es einmal das Vaultwarden Docker Image&hellip;","author":{"@type":"Person","name":"Finecloud","url":"https://www.finecloud.ch/authors/finecloud/"},"publisher":{"@type":"Organization","name":"Finecloud"}}</script><meta name="google-site-verification" content="seFY9U12uiEq5U3_MyZiX6XWzk0AVFl9zITr2ZKsytY"></head><body><div class="site-container"><header class="top" id="js-header"><a class="logo" href="https://www.finecloud.ch/">Finecloud</a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://www.finecloud.ch/" target="_self">Blog</a></li><li><a href="https://www.finecloud.ch/tags/" target="_self">Tags</a></li></ul></nav><div class="search"><div class="search__overlay js-search-overlay"><div class="search__overlay-inner"><form action="https://www.finecloud.ch/search.html" class="search__form"><input class="search__input js-search-input" type="search" name="q" placeholder="search..." aria-label="search..." autofocus="autofocus"></form><button class="search__close js-search-close" aria-label="Close">Close</button></div></div><button class="search__btn js-search-btn" aria-label="Search"><svg role="presentation" focusable="false"><use xlink:href="https://www.finecloud.ch/assets/svg/svg-map.svg#search"/></svg></button></div></header><main><article class="post"><div class="hero"><figure class="hero__image hero__image--overlay"><img src="https://www.finecloud.ch/media/website/download.jpg" srcset="https://www.finecloud.ch/media/website/responsive/download-xs.jpg 300w, https://www.finecloud.ch/media/website/responsive/download-sm.jpg 480w, https://www.finecloud.ch/media/website/responsive/download-md.jpg 768w, https://www.finecloud.ch/media/website/responsive/download-lg.jpg 1024w, https://www.finecloud.ch/media/website/responsive/download-xl.jpg 1360w, https://www.finecloud.ch/media/website/responsive/download-2xl.jpg 1600w" sizes="100vw" loading="eager" alt=""></figure><header class="hero__content"><div class="wrapper"><div class="post__meta"><time datetime="2022-05-24T07:23">Mai 24, 2022</time></div><h1>Vaultwarden Backup mit Rclone</h1></div></header></div><div class="wrapper post__entry"><p>Vaultwarden ist eine alternative Implementation der Bitwarden Server API entwickelt in Rust, kompatibel mit allen Bitwarden clients. Vaultwarden eignet sich daher perfekt für self-hosted deployments, oder überall dort wo der offizielle Bitwarden Service nicht ideal geeignet ist. Dazu gibt es einmal das <a href="https://hub.docker.com/r/vaultwarden/server" target="_blank" rel="nofollow noopener noreferrer">Vaultwarden Docker Image</a> und den dazu gehörenden SourceCode auf <a href="https://github.com/dani-garcia/vaultwarden" target="_blank" rel="nofollow noopener noreferrer">Github</a>.</p><p>Doch wie kann ich nun meine Vaultwarden Docker Instanz sichern? Dazu kann ich das Docker Image von <a href="https://github.com/ttionya/vaultwarden-backup" target="_blank" rel="nofollow noopener noreferrer">https://github.com/ttionya/vaultwarden-backup</a> empfehlen, das folgende Möglichkeiten bringt:</p><p>Backup der folgenden Dateien und Verzeichnisse:</p><ul><li>db.sqlite3</li><li>config.json</li><li>rsa_key* (mehrere Dateien)</li><li>attachments (Verzeichnis)</li><li>sends (Verzeichnis)</li></ul><p>Weiter ist es möglich über den Backup-Status notifiziert zu werden mittels:</p><ul><li>Ping (sendet nur bei erfolgreichem Backup)</li><li>Mail (SMTP basiert, sendet bei Backup Erfolg und Fehler)</li></ul><p>Nun stellt sich die Frage wohin sichern mit valtwarden-backup? Dazu habe ich an einem anderen Gerät in meinem Netzwerk eine externe USB Disk, auf welche ich die Backups mittels <a href="https://rclone.org/" target="_blank" rel="nofollow noopener noreferrer">Rclone</a> senden kann. Rclone lässt sich in vaultwarden-backup wie folgt einrichten:</p><pre>docker run --rm -it \<br>    --mount type=volume,source=vaultwarden-rclone-data,target=/config/ \<br>    ttionya/vaultwarden-backup:latest \<br>    rclone config</pre><p>Mit diesem Aufruf lässt sich innerhalb von vaultwarden-backup Rclone konfigurieren:</p><pre>2022/05/24 05:50:00 NOTICE: Config file "/config/rclone/rclone.conf" not found - using defaults<br>No remotes found, make a new one?<br>n) New remote<br>s) Set configuration password<br>q) Quit config<br>n/s/q&gt; </pre><p>Wir geben "n" an für eine neue Konfiguration:</p><pre>n/s/q&gt;n</pre><p>Anschliessend eine passende Bezeichnung für die Rclone Konfiguriation:</p><pre class="p1"><span class="s1">name&gt; rclone-backup</span></pre><p>Nun werden alle Rclone Backup Optionen aufgelistet:</p><pre>Option Storage.<br>Type of storage to configure.<br>Choose a number from below, or type in your own value.<br> 1 / 1Fichier<br>   \ (fichier)<br> 2 / Akamai NetStorage<br>   \ (netstorage)<br> 3 / Alias for an existing remote<br>   \ (alias)<br> 4 / Amazon Drive<br>   \ (amazon cloud drive)<br> 5 / Amazon S3 Compliant Storage Providers including AWS, Alibaba, Ceph, China Mobile, Digital Ocean, Dreamhost, IBM COS, Lyve Cloud, Minio, Netease, RackCorp, Scaleway, SeaweedFS, StackPath, Storj, Tencent COS and Wasabi<br>   \ (s3)<br> 6 / Backblaze B2<br>   \ (b2)<br> 7 / Better checksums for other remotes<br>   \ (hasher)<br> 8 / Box<br>   \ (box)<br> 9 / Cache a remote<br>   \ (cache)<br>10 / Citrix Sharefile<br>   \ (sharefile)<br>11 / Compress a remote<br>   \ (compress)<br>12 / Dropbox<br>   \ (dropbox)<br>13 / Encrypt/Decrypt a remote<br>   \ (crypt)<br>14 / Enterprise File Fabric<br>   \ (filefabric)<br>15 / FTP Connection<br>   \ (ftp)<br>16 / Google Cloud Storage (this is not Google Drive)<br>   \ (google cloud storage)<br>17 / Google Drive<br>   \ (drive)<br>18 / Google Photos<br>   \ (google photos)<br>19 / Hadoop distributed file system<br>   \ (hdfs)<br>20 / Hubic<br>   \ (hubic)<br>21 / In memory object storage system.<br>   \ (memory)<br>22 / Jottacloud<br>   \ (jottacloud)<br>23 / Koofr, Digi Storage and other Koofr-compatible storage providers<br>   \ (koofr)<br>24 / Local Disk<br>   \ (local)<br>25 / Mail.ru Cloud<br>   \ (mailru)<br>26 / Mega<br>   \ (mega)<br>27 / Microsoft Azure Blob Storage<br>   \ (azureblob)<br>28 / Microsoft OneDrive<br>   \ (onedrive)<br>29 / OpenDrive<br>   \ (opendrive)<br>30 / OpenStack Swift (Rackspace Cloud Files, Memset Memstore, OVH)<br>   \ (swift)<br>31 / Pcloud<br>   \ (pcloud)<br>32 / Put.io<br>   \ (putio)<br>33 / QingCloud Object Storage<br>   \ (qingstor)<br>34 / SSH/SFTP Connection<br>   \ (sftp)<br>35 / Sia Decentralized Cloud<br>   \ (sia)<br>36 / Storj Decentralized Cloud Storage<br>   \ (storj)<br>37 / Sugarsync<br>   \ (sugarsync)<br>38 / Transparently chunk/split large files<br>   \ (chunker)<br>39 / Union merges the contents of several upstream fs<br>   \ (union)<br>40 / Uptobox<br>   \ (uptobox)<br>41 / Webdav<br>   \ (webdav)<br>42 / Yandex Disk<br>   \ (yandex)<br>43 / Zoho<br>   \ (zoho)<br>44 / http Connection<br>   \ (http)<br>45 / premiumize.me<br>   \ (premiumizeme)<br>46 / seafile<br>   \ (seafile)</pre><p>Ich verwende Option 34 (34 / SSH/SFTP Connection):</p><pre>  Storage&gt; 34</pre><p>Jetzt muss ich den Host, auf welchem ich die externe USB Disk bereitgestellt habe angeben:</p><pre>  Option host.<br>  SSH host to connect to.<br>  E.g. "example.com".<br>  Enter a string value. Press Enter for the default ("").<br>  host&gt; backup-nas.local</pre><p>Der Benutzername mit welchem sich Rclone am Zielsystem authentifizieren kann:</p><pre>Option user.<br>SSH username.<br>Enter a string value. Press Enter for the default (root).<br>user&gt; backup-service-account</pre><p>Als nächstes kann man den SSH Port angeben (falls man nicht 22 verwendet), weiter möchte ich ein Kennwort angeben (noch besser ist die Kennwortlose Authentifizierung nur mit SSH-Keys):</p><pre>Option port.<br>SSH port number.<br>Enter a signed integer. Press Enter for the default (22).<br>port&gt; <br>Option pass.<br>SSH password, leave blank to use ssh-agent.<br>Choose an alternative below. Press Enter for the default (n).<br>y) Yes, type in my own password<br>g) Generate random password<br>n) No, leave this optional password blank (default)<br>y/g/n&gt; y</pre><p>Es folgt ein Marathon von weiteren Optionen, welche ich zur Zeit nicht verwenden will und deshalb mit den default Werten (Enter) bestätige:</p><pre>Option key_pem.<br>Raw PEM-encoded private key.<br>If specified, will override key_file parameter.<br>Enter a value. Press Enter to leave empty.<br>key_pem&gt; <br>Option key_file.<br>Path to PEM-encoded private key file.<br>Leave blank or set key-use-agent to use ssh-agent.<br>Leading `~` will be expanded in the file name as will environment variables such as `${RCLONE_CONFIG_DIR}`.<br>Enter a value. Press Enter to leave empty.<br>key_file&gt; <br>Option key_file_pass.<br>The passphrase to decrypt the PEM-encoded private key file.<br>Only PEM encrypted key files (old OpenSSH format) are supported. Encrypted keys<br>in the new OpenSSH format can't be used.<br>Choose an alternative below. Press Enter for the default (n).<br>y) Yes, type in my own password<br>g) Generate random password<br>n) No, leave this optional password blank (default)<br>y/g/n&gt; <br>Option pubkey_file.<br>Optional path to public key file.<br>Set this if you have a signed certificate you want to use for authentication.<br>Leading `~` will be expanded in the file name as will environment variables such as `${RCLONE_CONFIG_DIR}`.<br>Enter a value. Press Enter to leave empty.<br>pubkey_file&gt; <br>Option key_use_agent.<br>When set forces the usage of the ssh-agent.<br>When key-file is also set, the ".pub" file of the specified key-file is read and only the associated key is<br>requested from the ssh-agent. This allows to avoid `Too many authentication failures for *username*` errors<br>when the ssh-agent contains many keys.<br>Enter a boolean value (true or false). Press Enter for the default (false).<br>key_use_agent&gt; <br>Option use_insecure_cipher.<br>Enable the use of insecure ciphers and key exchange methods. <br>This enables the use of the following insecure ciphers and key exchange methods:<br>- aes128-cbc<br>- aes192-cbc<br>- aes256-cbc<br>- 3des-cbc<br>- diffie-hellman-group-exchange-sha256<br>- diffie-hellman-group-exchange-sha1<br>Those algorithms are insecure and may allow plaintext data to be recovered by an attacker.<br>Choose a number from below, or type in your own boolean value (true or false).<br>Press Enter for the default (false).<br> 1 / Use default Cipher list.<br>   \ (false)<br> 2 / Enables the use of the aes128-cbc cipher and diffie-hellman-group-exchange-sha256, diffie-hellman-group-exchange-sha1 key exchange.<br>   \ (true)<br>use_insecure_cipher&gt; <br>Option disable_hashcheck.<br>Disable the execution of SSH commands to determine if remote file hashing is available.<br>Leave blank or set to false to enable hashing (recommended), set to true to disable hashing.<br>Enter a boolean value (true or false). Press Enter for the default (false).<br>disable_hashcheck&gt; <br>Edit advanced config?<br>y) Yes<br>n) No (default)<br>y/n&gt; <br>--------------------<br>[rclone-backup]<br>type = sftp<br>host = backup-nas.local<br>user = backup-service-account<br>pass = *** ENCRYPTED ***<br>--------------------<br>y) Yes this is OK (default)<br>e) Edit this remote<br>d) Delete this remote<br>y/e/d&gt; y<br>Current remotes:<br><br>Name                 Type<br>====                 ====<br>rclone-backup        sftp<br><br>e) Edit existing remote<br>n) New remote<br>d) Delete remote<br>r) Rename remote<br>c) Copy remote<br>s) Set configuration password<br>q) Quit config<br>e/n/d/r/c/s/q&gt; q</pre><p>Mit dem folgenden Befehl sollten wir nun das Docker Volume dieses Containers sehen:</p><pre>user@myhost:~ $ docker volume ls<br>DRIVER    VOLUME NAME<br>local     vaultwarden-rclone-data</pre><p>Auch können wir nun prüfen, ob darin die Rclone Konfiguration korrekt gespeichert ist, indem wir diese aufrufen, dieser Befehl sollte unsere vorherige Konfiguration ausgeben:</p><pre>user@myhost:~ $ docker run --rm -it   --mount type=volume,source=vaultwarden-rclone-data,target=/config/   ttionya/vaultwarden-backup:latest   rclone config show</pre><p>Ich habe zudem eine Mail Notifizierung via Gmail konfiguriert, damit sieht das docker-compose File letztendlich wie folgt aus:</p><pre>  backup:<br>    image: ttionya/vaultwarden-backup:latest<br>    restart: always<br>    volumes:<br>      - /var/docker/vaultwarden:/bitwarden/data/:ro<br>      - /var/docker/vaultwarden-rclone-data:/config/:ro<br>    environment:<br>      RCLONE_REMOTE_NAME: 'remote'<br>      RCLONE_REMOTE_DIR: '/Backup/'<br>      CRON: '0 18 * * *'<br>      ZIP_ENABLE: 'TRUE'<br>      ZIP_PASSWORD: 'yourpasswordhere'<br>      ZIP_TYPE: 'zip'<br>      #BACKUP_FILE_DATE_SUFFIX: ''<br>      BACKUP_KEEP_DAYS: 7<br>      #PING_URL: ''<br>      MAIL_SMTP_ENABLE: 'TRUE'<br>      MAIL_SMTP_VARIABLES: '-S smtp-use-starttls -S ssl-verify=true -S smtp-auth=login -S smtp=smtp://smtp.gmail.com:587 -S from=yourmailhere -S smtp-auth-user=yourmailhere -S smtp-auth-password=yourpasswordhere -S ssl-verify=true'<br>      MAIL_TO: 'yourmailhere'<br>      MAIL_WHEN_SUCCESS: 'TRUE'<br>      MAIL_WHEN_FAILURE: 'TRUE'<br>      TIMEZONE: 'Europe/Zurich'</pre><p>Der Mailversand lässt sich mit diesem Befehl testen, natürlich müssen zuerst noch die Variabeln von vorhin eingetragen werden:</p><pre>user@myhost:~ $ docker run --rm -it -e MAIL_SMTP_VARIABLES='-S smtp-use-starttls  ....' -e MAIL_TO='yourmailhere' ttionya/vaultwarden-backup:latest mail</pre><p>Ob der Mailversand funktioniert zeigt sich damit, ob dieser Befehlt zuletzt </p><blockquote><p>mail send was successfully</p></blockquote><p>ausgibt und ob nun eine EMail im Postfach landet mit dem Inhalt:</p><blockquote><p>Your SMTP looks configured correctly.</p></blockquote></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on Mai 24, 2022</p><ul class="post__tag"><li><a href="https://www.finecloud.ch/tags/ansible/">ansible</a></li><li><a href="https://www.finecloud.ch/tags/backup/">backup</a></li><li><a href="https://www.finecloud.ch/tags/docker/">docker</a></li><li><a href="https://www.finecloud.ch/tags/rclone/">rclone</a></li><li><a href="https://www.finecloud.ch/tags/smtp/">smtp</a></li><li><a href="https://www.finecloud.ch/tags/vaultwarden/">vaultwarden</a></li></ul><div class="post__share"></div></footer></article><nav class="post__nav"><div class="post__nav-inner"><div class="post__nav-prev"><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://www.finecloud.ch/assets/svg/svg-map.svg#arrow-prev"/></svg> <a href="https://www.finecloud.ch/mehrdimensionale-java-arrays.html" class="post__nav-link" rel="prev"><span>Previous</span> Mehrdimensionale Java Arrays</a></div><div class="post__nav-next"><a href="https://www.finecloud.ch/die-for-each-schleife-2.html" class="post__nav-link" rel="next"><span>Next</span> Die for-each Schleife </a><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://www.finecloud.ch/assets/svg/svg-map.svg#arrow-next"/></svg></div></div></nav><div class="post__related related"><div class="wrapper"><h2 class="h5 related__title">You should also read:</h2><article class="related__item"><div class="feed__meta"><time datetime="2022-07-08T15:47" class="feed__date">Juli 8, 2022</time></div><h3 class="h1"><a href="https://www.finecloud.ch/citrix-adc-backup-mit-ansible.html">Citrix ADC (NetScaler) Backup mit Ansible</a></h3></article></div></div></main><footer class="footer"><div class="footer__copyright"><p>Powered by Publii</p></div><button onclick="backToTopFunction()" id="backToTop" class="footer__bttop" aria-label="Back to top" title="Back to top"><svg><use xlink:href="https://www.finecloud.ch/assets/svg/svg-map.svg#toparrow"/></svg></button></footer></div><script>window.publiiThemeMenuConfig = {    
        mobileMenuMode: 'sidebar',
        animationSpeed: 300,
        submenuWidth: 'auto',
        doubleClickTime: 500,
        mobileMenuExpandableSubmenus: true, 
        relatedContainerForOverlayMenuSelector: '.top',
   };</script><script defer="defer" src="https://www.finecloud.ch/assets/js/scripts.min.js?v=6ca8b60e6534a3888de1205e82df8528"></script><script>var images = document.querySelectorAll('img[loading]');

        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script></body></html>